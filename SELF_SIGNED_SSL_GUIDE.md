# è‡ªç­¾å SSL è¯ä¹¦ä½¿ç”¨æŒ‡å—

æœ¬æŒ‡å—ä»‹ç»å¦‚ä½•ä¸ºå¼€å‘å’Œæµ‹è¯•ç¯å¢ƒç”Ÿæˆå’Œä½¿ç”¨**è‡ªç­¾å SSL è¯ä¹¦**ã€‚

---

## ğŸ“– ä»€ä¹ˆæ˜¯è‡ªç­¾åè¯ä¹¦ï¼Ÿ

**è‡ªç­¾åè¯ä¹¦**æ˜¯ç”±è‡ªå·±ç­¾å‘çš„ SSL è¯ä¹¦ï¼Œè€Œä¸æ˜¯ç”±å—ä¿¡ä»»çš„è¯ä¹¦é¢å‘æœºæ„ï¼ˆCAï¼‰ç­¾å‘ã€‚

### ä¼˜ç‚¹

- âœ… **å®Œå…¨å…è´¹**ï¼šæ— éœ€ä»˜è´¹æˆ–æ³¨å†Œ
- âœ… **å³æ—¶ç”Ÿæˆ**ï¼šå‡ ç§’é’Ÿå†…å®Œæˆ
- âœ… **æ— éœ€åŸŸå**ï¼šå¯ç”¨äº localhost æˆ– IP åœ°å€
- âœ… **ç¦»çº¿å¯ç”¨**ï¼šä¸éœ€è¦äº’è”ç½‘è¿æ¥
- âœ… **å®Œå…¨æ§åˆ¶**ï¼šè‡ªå®šä¹‰æ‰€æœ‰è¯ä¹¦å‚æ•°

### ç¼ºç‚¹

- âš ï¸ **æµè§ˆå™¨è­¦å‘Š**ï¼šä¼šæ˜¾ç¤º"ä¸å®‰å…¨"è­¦å‘Š
- âš ï¸ **éœ€è¦æ‰‹åŠ¨ä¿¡ä»»**ï¼šæ¯ä¸ªè®¾å¤‡éƒ½éœ€è¦å¯¼å…¥è¯ä¹¦
- âš ï¸ **ä»…ç”¨äºæµ‹è¯•**ï¼šä¸èƒ½ç”¨äºç”Ÿäº§ç¯å¢ƒ

---

## ğŸš€ å¿«é€Ÿå¼€å§‹

### æ­¥éª¤ 1ï¼šç”Ÿæˆè‡ªç­¾åè¯ä¹¦

```bash
# è¿›å…¥é¡¹ç›®ç›®å½•
cd /medicine_reminder/medicine-reminder-main

# è¿è¡Œè¯ä¹¦ç”Ÿæˆè„šæœ¬
./generate-self-signed-cert.sh
```

**äº¤äº’å¼é…ç½®ï¼š**

```
è¯·è¾“å…¥åŸŸå [é»˜è®¤: localhost]: localhost
è¯ä¹¦æœ‰æ•ˆæœŸï¼ˆå¤©ï¼‰[é»˜è®¤: 365]: 365

è¯ä¹¦ä¿¡æ¯ï¼ˆå¯ç›´æ¥å›è½¦ä½¿ç”¨é»˜è®¤å€¼ï¼‰ï¼š
å›½å®¶ä»£ç  (C) [é»˜è®¤: CN]: 
çœä»½ (ST) [é»˜è®¤: Beijing]: 
åŸå¸‚ (L) [é»˜è®¤: Beijing]: 
ç»„ç»‡åç§° (O) [é»˜è®¤: Development]: 
éƒ¨é—¨ (OU) [é»˜è®¤: IT Department]: 

ç¡®è®¤ç”Ÿæˆè¯ä¹¦ï¼Ÿ(y/n) y
```

**ç”Ÿæˆçš„æ–‡ä»¶ï¼š**
```
ssl-certs/
â”œâ”€â”€ privkey.pem       # ç§é’¥
â”œâ”€â”€ fullchain.pem     # è¯ä¹¦
â””â”€â”€ certificate.pfx   # PFX æ ¼å¼ï¼ˆWindowsï¼‰
```

### æ­¥éª¤ 2ï¼šå¯åŠ¨æœåŠ¡

```bash
# ä½¿ç”¨è‡ªç­¾åè¯ä¹¦å¯åŠ¨
docker compose -f docker-compose.dev-ssl.yml up -d

# æŸ¥çœ‹æ—¥å¿—
docker compose -f docker-compose.dev-ssl.yml logs -f
```

### æ­¥éª¤ 3ï¼šè®¿é—®åº”ç”¨

**HTTPS è®¿é—®ï¼š** https://localhost  
**HTTP è®¿é—®ï¼š** http://localhost

---

## ğŸ” ä¿¡ä»»è¯ä¹¦ï¼ˆæ¶ˆé™¤æµè§ˆå™¨è­¦å‘Šï¼‰

### Windows

#### æ–¹æ³• 1ï¼šé€šè¿‡æµè§ˆå™¨

1. è®¿é—® `https://localhost`
2. ç‚¹å‡»åœ°å€æ çš„"ä¸å®‰å…¨"è­¦å‘Š
3. ç‚¹å‡»"è¯ä¹¦æ— æ•ˆ"
4. ç‚¹å‡»"è¯¦ç»†ä¿¡æ¯" â†’ "å¤åˆ¶åˆ°æ–‡ä»¶"
5. ä¿å­˜ä¸º `certificate.cer`
6. åŒå‡» `certificate.cer`
7. ç‚¹å‡»"å®‰è£…è¯ä¹¦"
8. é€‰æ‹©"æœ¬åœ°è®¡ç®—æœº" â†’ "å°†æ‰€æœ‰è¯ä¹¦æ”¾å…¥ä¸‹åˆ—å­˜å‚¨"
9. é€‰æ‹©"å—ä¿¡ä»»çš„æ ¹è¯ä¹¦é¢å‘æœºæ„"
10. å®Œæˆå®‰è£…
11. é‡å¯æµè§ˆå™¨

#### æ–¹æ³• 2ï¼šé€šè¿‡å‘½ä»¤è¡Œ

```powershell
# ä»¥ç®¡ç†å‘˜èº«ä»½è¿è¡Œ PowerShell
certutil -addstore -f "ROOT" ssl-certs\fullchain.pem
```

### macOS

#### æ–¹æ³• 1ï¼šé€šè¿‡é’¥åŒ™ä¸²è®¿é—®

1. æ‰“å¼€"é’¥åŒ™ä¸²è®¿é—®"åº”ç”¨
2. é€‰æ‹©"ç³»ç»Ÿ"é’¥åŒ™ä¸²
3. å°† `ssl-certs/fullchain.pem` æ‹–å…¥é’¥åŒ™ä¸²
4. åŒå‡»å¯¼å…¥çš„è¯ä¹¦
5. å±•å¼€"ä¿¡ä»»"éƒ¨åˆ†
6. å°†"ä½¿ç”¨æ­¤è¯ä¹¦æ—¶"è®¾ç½®ä¸º"å§‹ç»ˆä¿¡ä»»"
7. å…³é—­çª—å£å¹¶è¾“å…¥å¯†ç ç¡®è®¤

#### æ–¹æ³• 2ï¼šé€šè¿‡å‘½ä»¤è¡Œ

```bash
sudo security add-trusted-cert -d -r trustRoot -k /Library/Keychains/System.keychain ssl-certs/fullchain.pem
```

### Linux (Ubuntu/Debian)

```bash
# å¤åˆ¶è¯ä¹¦åˆ°ç³»ç»Ÿè¯ä¹¦ç›®å½•
sudo cp ssl-certs/fullchain.pem /usr/local/share/ca-certificates/medicine-reminder.crt

# æ›´æ–°è¯ä¹¦å­˜å‚¨
sudo update-ca-certificates

# é‡å¯æµè§ˆå™¨
```

### Linux (CentOS/RHEL)

```bash
# å¤åˆ¶è¯ä¹¦
sudo cp ssl-certs/fullchain.pem /etc/pki/ca-trust/source/anchors/medicine-reminder.crt

# æ›´æ–°è¯ä¹¦å­˜å‚¨
sudo update-ca-trust

# é‡å¯æµè§ˆå™¨
```

### Chrome/Edge æµè§ˆå™¨

1. æ‰“å¼€æµè§ˆå™¨è®¾ç½®
2. æœç´¢"è¯ä¹¦"
3. ç‚¹å‡»"ç®¡ç†è¯ä¹¦"
4. é€‰æ‹©"å—ä¿¡ä»»çš„æ ¹è¯ä¹¦é¢å‘æœºæ„"æ ‡ç­¾
5. ç‚¹å‡»"å¯¼å…¥"
6. é€‰æ‹© `ssl-certs/fullchain.pem`
7. å®Œæˆå¯¼å…¥
8. é‡å¯æµè§ˆå™¨

### Firefox æµè§ˆå™¨

1. æ‰“å¼€ Firefox è®¾ç½®
2. æœç´¢"è¯ä¹¦"
3. ç‚¹å‡»"æŸ¥çœ‹è¯ä¹¦"
4. é€‰æ‹©"è¯ä¹¦é¢å‘æœºæ„"æ ‡ç­¾
5. ç‚¹å‡»"å¯¼å…¥"
6. é€‰æ‹© `ssl-certs/fullchain.pem`
7. å‹¾é€‰"ä¿¡ä»»æ­¤ CA ä»¥æ ‡è¯†ç½‘ç«™"
8. ç¡®å®š

---

## ğŸ”§ é«˜çº§ç”¨æ³•

### è‡ªå®šä¹‰åŸŸå

ç”Ÿæˆè¯ä¹¦æ—¶æŒ‡å®šåŸŸåï¼š

```bash
./generate-self-signed-cert.sh
# è¾“å…¥: medicine.local
```

ç„¶åä¿®æ”¹ `/etc/hosts`ï¼š

```bash
# Linux/macOS
sudo nano /etc/hosts

# Windows
notepad C:\Windows\System32\drivers\etc\hosts
```

æ·»åŠ ï¼š
```
127.0.0.1  medicine.local
```

è®¿é—®ï¼š`https://medicine.local`

### å¤šåŸŸåæ”¯æŒ

ä¿®æ”¹è„šæœ¬ä¸­çš„ `cert.ext` éƒ¨åˆ†ï¼š

```bash
[alt_names]
DNS.1 = localhost
DNS.2 = medicine.local
DNS.3 = dev.medicine.local
IP.1 = 127.0.0.1
IP.2 = 192.168.1.100
```

### å»¶é•¿æœ‰æ•ˆæœŸ

ç”Ÿæˆè¯ä¹¦æ—¶è®¾ç½®æ›´é•¿çš„æœ‰æ•ˆæœŸï¼š

```bash
./generate-self-signed-cert.sh
# è¯ä¹¦æœ‰æ•ˆæœŸï¼ˆå¤©ï¼‰: 3650  # 10å¹´
```

### æŸ¥çœ‹è¯ä¹¦ä¿¡æ¯

```bash
# æŸ¥çœ‹è¯ä¹¦è¯¦æƒ…
openssl x509 -in ssl-certs/fullchain.pem -text -noout

# æŸ¥çœ‹è¯ä¹¦æœ‰æ•ˆæœŸ
openssl x509 -in ssl-certs/fullchain.pem -noout -dates

# æŸ¥çœ‹è¯ä¹¦æŒ‡çº¹
openssl x509 -in ssl-certs/fullchain.pem -noout -fingerprint -sha256
```

---

## ğŸ§ª æµ‹è¯•å’ŒéªŒè¯

### æµ‹è¯• SSL è¿æ¥

```bash
# ä½¿ç”¨ curl æµ‹è¯•ï¼ˆå¿½ç•¥è¯ä¹¦éªŒè¯ï¼‰
curl -k https://localhost

# ä½¿ç”¨ curl æµ‹è¯•ï¼ˆæŒ‡å®šè¯ä¹¦ï¼‰
curl --cacert ssl-certs/fullchain.pem https://localhost

# ä½¿ç”¨ openssl æµ‹è¯•
openssl s_client -connect localhost:443 -showcerts
```

### éªŒè¯è¯ä¹¦é…ç½®

```bash
# æ£€æŸ¥ Nginx é…ç½®
docker compose -f docker-compose.dev-ssl.yml exec nginx nginx -t

# æŸ¥çœ‹ Nginx æ—¥å¿—
docker compose -f docker-compose.dev-ssl.yml logs nginx
```

---

## ğŸ“ æ–‡ä»¶è¯´æ˜

| æ–‡ä»¶ | è¯´æ˜ | ç”¨é€” |
|------|------|------|
| `privkey.pem` | ç§é’¥ | Nginx SSL é…ç½® |
| `fullchain.pem` | è¯ä¹¦ | Nginx SSL é…ç½® + æµè§ˆå™¨ä¿¡ä»» |
| `certificate.pfx` | PFX æ ¼å¼ | Windows å¯¼å…¥ |

---

## ğŸ”„ æ›´æ–°è¯ä¹¦

### è¯ä¹¦è¿‡æœŸåé‡æ–°ç”Ÿæˆ

```bash
# åˆ é™¤æ—§è¯ä¹¦
rm -rf ssl-certs/

# é‡æ–°ç”Ÿæˆ
./generate-self-signed-cert.sh

# é‡å¯æœåŠ¡
docker compose -f docker-compose.dev-ssl.yml restart nginx
```

---

## ğŸ†š å¯¹æ¯”ï¼šè‡ªç­¾å vs Let's Encrypt

| ç‰¹æ€§ | è‡ªç­¾åè¯ä¹¦ | Let's Encrypt |
|------|-----------|---------------|
| **è´¹ç”¨** | å…è´¹ | å…è´¹ |
| **ç”Ÿæˆé€Ÿåº¦** | å³æ—¶ï¼ˆå‡ ç§’ï¼‰ | éœ€è¦éªŒè¯ï¼ˆ2-3åˆ†é’Ÿï¼‰ |
| **æµè§ˆå™¨ä¿¡ä»»** | âŒ éœ€è¦æ‰‹åŠ¨ä¿¡ä»» | âœ… è‡ªåŠ¨ä¿¡ä»» |
| **åŸŸåè¦æ±‚** | âŒ ä¸éœ€è¦ | âœ… éœ€è¦å…¬ç½‘åŸŸå |
| **äº’è”ç½‘è¦æ±‚** | âŒ ç¦»çº¿å¯ç”¨ | âœ… éœ€è¦è”ç½‘ |
| **æœ‰æ•ˆæœŸ** | è‡ªå®šä¹‰ï¼ˆ1-10å¹´ï¼‰ | 90å¤©ï¼ˆè‡ªåŠ¨ç»­æœŸï¼‰ |
| **é€‚ç”¨åœºæ™¯** | å¼€å‘/æµ‹è¯•/å†…ç½‘ | ç”Ÿäº§ç¯å¢ƒ |

---

## ğŸ’¡ æœ€ä½³å®è·µ

### 1. å¼€å‘ç¯å¢ƒæ¨èé…ç½®

```bash
# ç”Ÿæˆ 10 å¹´æœ‰æ•ˆæœŸçš„è¯ä¹¦
åŸŸå: localhost
æœ‰æ•ˆæœŸ: 3650 å¤©
```

### 2. å›¢é˜Ÿå…±äº«è¯ä¹¦

å°†ç”Ÿæˆçš„è¯ä¹¦æäº¤åˆ°ä»£ç ä»“åº“ï¼š

```bash
git add ssl-certs/
git commit -m "Add self-signed SSL certificates for development"
git push
```

å›¢é˜Ÿæˆå‘˜å…‹éš†åç›´æ¥ä½¿ç”¨ï¼Œæ— éœ€é‡æ–°ç”Ÿæˆã€‚

### 3. å¤šé¡¹ç›®è¯ä¹¦ç®¡ç†

ä¸ºä¸åŒé¡¹ç›®ä½¿ç”¨ä¸åŒçš„åŸŸåï¼š

- é¡¹ç›® A: `medicine.local`
- é¡¹ç›® B: `pharmacy.local`
- é¡¹ç›® C: `health.local`

### 4. è‡ªåŠ¨åŒ–è„šæœ¬

åˆ›å»ºä¸€é”®å¯åŠ¨è„šæœ¬ï¼š

```bash
#!/bin/bash
# start-dev-ssl.sh

# æ£€æŸ¥è¯ä¹¦æ˜¯å¦å­˜åœ¨
if [ ! -f "ssl-certs/fullchain.pem" ]; then
    echo "è¯ä¹¦ä¸å­˜åœ¨ï¼Œæ­£åœ¨ç”Ÿæˆ..."
    ./generate-self-signed-cert.sh
fi

# å¯åŠ¨æœåŠ¡
docker compose -f docker-compose.dev-ssl.yml up -d

echo "æœåŠ¡å·²å¯åŠ¨ï¼š"
echo "  HTTPS: https://localhost"
echo "  HTTP:  http://localhost"
```

---

## ğŸ› ï¸ æ•…éšœæ’æŸ¥

### é—®é¢˜ 1ï¼šæµè§ˆå™¨ä»æ˜¾ç¤ºä¸å®‰å…¨

**åŸå› ï¼š** è¯ä¹¦æœªæ­£ç¡®ä¿¡ä»»

**è§£å†³ï¼š**
1. ç¡®è®¤è¯ä¹¦å·²å¯¼å…¥åˆ°"å—ä¿¡ä»»çš„æ ¹è¯ä¹¦é¢å‘æœºæ„"
2. é‡å¯æµè§ˆå™¨
3. æ¸…é™¤æµè§ˆå™¨ç¼“å­˜
4. æ£€æŸ¥è¯ä¹¦æœ‰æ•ˆæœŸ

### é—®é¢˜ 2ï¼šNginx å¯åŠ¨å¤±è´¥

**é”™è¯¯ï¼š** `SSL: error:02001002:system library:fopen:No such file or directory`

**åŸå› ï¼š** è¯ä¹¦æ–‡ä»¶è·¯å¾„ä¸æ­£ç¡®

**è§£å†³ï¼š**
```bash
# æ£€æŸ¥è¯ä¹¦æ–‡ä»¶æ˜¯å¦å­˜åœ¨
ls -l ssl-certs/

# æ£€æŸ¥ docker-compose.dev-ssl.yml ä¸­çš„è·¯å¾„æ˜ å°„
# åº”è¯¥æ˜¯: ./ssl-certs:/etc/nginx/ssl:ro
```

### é—®é¢˜ 3ï¼šè¯ä¹¦è¿‡æœŸ

**æ£€æŸ¥æœ‰æ•ˆæœŸï¼š**
```bash
openssl x509 -in ssl-certs/fullchain.pem -noout -dates
```

**è§£å†³ï¼š** é‡æ–°ç”Ÿæˆè¯ä¹¦

---

## ğŸ”’ å®‰å…¨æ³¨æ„äº‹é¡¹

### âš ï¸ é‡è¦æé†’

1. **ä¸è¦ç”¨äºç”Ÿäº§ç¯å¢ƒ**
   - è‡ªç­¾åè¯ä¹¦ä¸è¢«æµè§ˆå™¨ä¿¡ä»»
   - ç”¨æˆ·ä¼šçœ‹åˆ°å®‰å…¨è­¦å‘Š
   - å¯èƒ½å½±å“ SEO å’Œç”¨æˆ·ä½“éªŒ

2. **ä¿æŠ¤ç§é’¥**
   - ä¸è¦å°† `privkey.pem` æäº¤åˆ°å…¬å¼€ä»“åº“
   - æ·»åŠ åˆ° `.gitignore`ï¼š
     ```
     ssl-certs/privkey.pem
     ```

3. **å®šæœŸæ›´æ–°**
   - å³ä½¿æ˜¯å¼€å‘ç¯å¢ƒï¼Œä¹Ÿå»ºè®®æ¯å¹´æ›´æ–°è¯ä¹¦
   - ä½¿ç”¨è¾ƒçŸ­çš„æœ‰æ•ˆæœŸï¼ˆå¦‚ 365 å¤©ï¼‰

4. **å›¢é˜Ÿåä½œ**
   - å›¢é˜Ÿå…±äº«è¯ä¹¦æ—¶ï¼Œç¡®ä¿é€šè¿‡å®‰å…¨æ¸ é“ä¼ è¾“
   - æˆ–è€…æ¯ä¸ªå¼€å‘è€…è‡ªå·±ç”Ÿæˆ

---

## ğŸ“š ç›¸å…³èµ„æº

- **OpenSSL æ–‡æ¡£**: https://www.openssl.org/docs/
- **Let's Encryptï¼ˆç”Ÿäº§ç¯å¢ƒï¼‰**: [SSL_SETUP_GUIDE.md](./SSL_SETUP_GUIDE.md)
- **MDN Web å®‰å…¨**: https://developer.mozilla.org/zh-CN/docs/Web/Security

---

## ğŸ‰ å®Œæˆ

é…ç½®å®Œæˆåï¼Œæ‚¨å¯ä»¥ï¼š

- âœ… åœ¨æœ¬åœ°ä½¿ç”¨ HTTPS å¼€å‘
- âœ… æµ‹è¯• HTTPS ç›¸å…³åŠŸèƒ½ï¼ˆå¦‚æµè§ˆå™¨é€šçŸ¥ï¼‰
- âœ… æ¨¡æ‹Ÿç”Ÿäº§ç¯å¢ƒçš„ SSL é…ç½®
- âœ… æ— éœ€å…¬ç½‘åŸŸåå’Œäº’è”ç½‘è¿æ¥

**å¼€å‘è®¿é—®ï¼š** https://localhost

**ç”Ÿäº§éƒ¨ç½²ï¼š** ä½¿ç”¨ Let's Encrypt è¯ä¹¦ï¼ˆå‚è€ƒ [SSL_SETUP_GUIDE.md](./SSL_SETUP_GUIDE.md)ï¼‰
